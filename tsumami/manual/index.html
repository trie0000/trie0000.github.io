<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>つまみん ユーザーマニュアル</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #FFF0F5;
            --accent-pink: #FFB6C1;
            --dark-pink: #FF69B4;
            --text-dark: #333;
            --text-light: #666;
            --border-color: #E5E5E5;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
            line-height: 1.8;
            color: var(--text-dark);
            background: linear-gradient(135deg, #FFF9FB 0%, #FFF 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--dark-pink) 0%, var(--accent-pink) 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
            padding: 2rem 1rem;
        }

        .sidebar {
            width: 280px;
            flex-shrink: 0;
        }

        .toc {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 2rem;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .toc h2 {
            font-size: 1.2rem;
            color: var(--dark-pink);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-pink);
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin: 0.5rem 0;
        }

        .toc a {
            color: var(--text-light);
            text-decoration: none;
            display: block;
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .toc a:hover {
            background: var(--primary-pink);
            color: var(--dark-pink);
        }

        .toc .toc-level-2 {
            padding-left: 1rem;
            font-size: 0.95rem;
        }

        .toc .toc-level-3 {
            padding-left: 2rem;
            font-size: 0.9rem;
        }

        .content {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 3rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .content h2 {
            font-size: 2rem;
            color: var(--dark-pink);
            margin: 2.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary-pink);
        }

        .content h2:first-child {
            margin-top: 0;
        }

        .content h3 {
            font-size: 1.5rem;
            color: var(--text-dark);
            margin: 2rem 0 1rem;
            padding-left: 0.75rem;
            border-left: 4px solid var(--accent-pink);
        }

        .content h4 {
            font-size: 1.2rem;
            color: var(--text-dark);
            margin: 1.5rem 0 0.75rem;
        }

        .content p {
            margin: 1rem 0;
            color: var(--text-light);
        }

        .content ul, .content ol {
            margin: 1rem 0 1rem 2rem;
            color: var(--text-light);
        }

        .content li {
            margin: 0.5rem 0;
        }

        figure {
            margin: 2rem 0;
            text-align: center;
        }

        figure img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s;
        }

        figure img:hover {
            box-shadow: var(--shadow-hover);
        }

        figcaption {
            margin-top: 0.75rem;
            color: var(--text-light);
            font-size: 0.95rem;
            font-style: italic;
        }

        .annotated-img {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }

        .annotated-img img {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .annotation-box {
            position: absolute;
            border: 2.5px solid #E0607E;
            border-radius: 4px;
            pointer-events: none;
        }

        .annotation-box::after {
            content: attr(data-label);
            position: absolute;
            top: -22px;
            left: 0;
            background: #E0607E;
            color: white;
            font-size: 11px;
            font-weight: bold;
            padding: 1px 8px;
            border-radius: 3px;
            white-space: nowrap;
        }

        .annotation-box.label-bottom::after {
            top: auto;
            bottom: -22px;
        }

        .annotation-box.label-right::after {
            left: auto;
            right: 0;
        }

        /* 第2色: ティール系（同じ画像で2種類のアノテーションを使い分け） */
        .annotation-box.color-teal {
            border-color: #3A9E95;
        }
        .annotation-box.color-teal::after {
            background: #3A9E95;
        }

        /* 第3色: ネイビー系 */
        .annotation-box.color-navy {
            border-color: #5B7BB4;
        }
        .annotation-box.color-navy::after {
            background: #5B7BB4;
        }

        /* 第4色: アンバー系 */
        .annotation-box.color-amber {
            border-color: #D4914E;
        }
        .annotation-box.color-amber::after {
            background: #D4914E;
        }

        .img-pair {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .img-pair figure {
            flex: 1;
            min-width: 200px;
            margin: 0;
        }

        .img-pair figure img {
            width: 100%;
        }

        .img-pair .full-view {
            flex: 2;
            min-width: 400px;
        }

        .img-pair .detail-view {
            flex: 1;
            min-width: 200px;
        }

        .tip-box {
            background: #FFF9E6;
            border-left: 4px solid #FFC107;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .tip-box::before {
            content: "💡 ヒント";
            display: block;
            font-weight: bold;
            color: #F57C00;
            margin-bottom: 0.5rem;
        }

        .important-box {
            background: var(--primary-pink);
            border-left: 4px solid var(--dark-pink);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .important-box::before {
            content: "⚠️ 重要";
            display: block;
            font-weight: bold;
            color: var(--dark-pink);
            margin-bottom: 0.5rem;
        }

        .shortcuts-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .shortcuts-table th,
        .shortcuts-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .shortcuts-table th {
            background: var(--primary-pink);
            color: var(--text-dark);
            font-weight: bold;
        }

        .shortcuts-table tr:hover {
            background: #FAFAFA;
        }

        .shortcuts-table kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--dark-pink);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            opacity: 0;
            pointer-events: none;
        }

        .back-to-top.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .back-to-top:hover {
            background: #FF1493;
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .zone-diagram {
            max-width: 600px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .feature-card {
            background: var(--primary-pink);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .feature-card h4 {
            margin-top: 0;
            color: var(--dark-pink);
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .toc {
                position: static;
                max-height: none;
            }

            .content {
                padding: 2rem 1.5rem;
            }
        }

        @media (max-width: 640px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .content {
                padding: 1.5rem 1rem;
            }

            .content h2 {
                font-size: 1.5rem;
            }

            .content h3 {
                font-size: 1.2rem;
            }
        }

        @media print {
            .header {
                background: white;
                color: var(--text-dark);
            }

            .sidebar,
            .back-to-top {
                display: none;
            }

            .container {
                display: block;
            }

            .content {
                box-shadow: none;
            }

            figure {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>つまみん ユーザーマニュアル</h1>
        <p>ブラウザで使える つまみ細工デザインツール</p>
    </div>

    <div class="container">
        <aside class="sidebar">
            <nav class="toc">
                <h2>目次</h2>
                <ul>
                    <li><a href="#intro">1. はじめに</a></li>
                    <li><a href="#overview">2. 画面構成</a>
                        <ul>
                            <li class="toc-level-2"><a href="#header">2.1 ヘッダー</a></li>
                            <li class="toc-level-2"><a href="#home">2.2 ホーム画面</a></li>
                            <li class="toc-level-2"><a href="#new-project">2.3 新規プロジェクト画面</a></li>
                        </ul>
                    </li>
                    <li><a href="#editor">3. エディタ画面</a>
                        <ul>
                            <li class="toc-level-2"><a href="#layout">3.1 3パネルレイアウト</a></li>
                            <li class="toc-level-2"><a href="#canvas">3.2 キャンバス操作</a></li>
                            <li class="toc-level-2"><a href="#flower-ops">3.3 花の操作</a></li>
                            <li class="toc-level-2"><a href="#zone-ops">3.4 ゾーン操作</a></li>
                            <li class="toc-level-2"><a href="#layer-panel">3.5 レイヤーパネル</a></li>
                            <li class="toc-level-2"><a href="#property-panel">3.6 プロパティパネル</a></li>
                            <li class="toc-level-2"><a href="#petal-shapes">3.7 花びらの形</a></li>
                            <li class="toc-level-2"><a href="#center">3.8 花芯</a></li>
                            <li class="toc-level-2"><a href="#color-palette">3.9 カラーパレット</a></li>
                            <li class="toc-level-2"><a href="#stencil">3.10 台紙</a></li>
                            <li class="toc-level-2"><a href="#petal-sizing">3.11 花びらサイズ調整</a></li>
                        </ul>
                    </li>
                    <li><a href="#recipe">4. レシピ画面</a></li>
                    <li><a href="#data">5. データ管理</a>
                        <ul>
                            <li class="toc-level-2"><a href="#save-load">5.1 保存と読み込み</a></li>
                            <li class="toc-level-2"><a href="#import-export">5.2 インポート/エクスポート</a></li>
                        </ul>
                    </li>
                    <li><a href="#shortcuts">6. キーボードショートカット</a></li>
                    <li><a href="#mobile">7. モバイル対応</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content">
            <section id="intro">
                <h2>1. はじめに</h2>

                <h3>つまみんとは</h3>
                <p>
                    つまみんは、伝統的な日本の手芸「つまみ細工」のデザインを簡単に作成できる、ブラウザベースのデザインツールです。
                    すべてのデータはお使いのコンピュータにローカル保存されるため、インターネット接続がなくても安心してご利用いただけます。
                </p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>✨ ブラウザで完結</h4>
                        <p>インストール不要。すぐに使い始められます。</p>
                    </div>
                    <div class="feature-card">
                        <h4>📱 PWA対応</h4>
                        <p>オフラインでも使用可能。アプリのように使えます。</p>
                    </div>
                    <div class="feature-card">
                        <h4>🎨 直感的な操作</h4>
                        <p>ドラッグ&ドロップで簡単にデザインできます。</p>
                    </div>
                    <div class="feature-card">
                        <h4>📋 レシピ自動生成</h4>
                        <p>材料表と工程を自動で作成します。</p>
                    </div>
                </div>

                <h3>対応ブラウザ</h3>
                <p>以下の最新版ブラウザに対応しています：</p>
                <ul>
                    <li>Google Chrome（推奨）</li>
                    <li>Microsoft Edge</li>
                    <li>Safari</li>
                    <li>Firefox</li>
                </ul>

                <div class="important-box">
                    データはブラウザのローカルストレージに保存されます。ブラウザのデータを削除するとプロジェクトも削除されますので、定期的にJSON形式でエクスポートしてバックアップを取ることをお勧めします。
                </div>
            </section>

            <section id="overview">
                <h2>2. 画面構成</h2>

                <h3 id="header">2.1 ヘッダー</h3>
                <p>
                    画面上部のヘッダーには、ナビゲーションタブとアクションボタンがあります。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/13_header_toolbar.png" alt="ヘッダーツールバー">
                        <div class="annotation-box" style="left: 35%; top: 5%; width: 22%; height: 80%;" data-label="ナビゲーションタブ"></div>
                        <div class="annotation-box" style="left: 58%; top: 5%; width: 40%; height: 80%;" data-label="アクションボタン"></div>
                    </div>
                    <figcaption>ヘッダーツールバー：ナビゲーションとアクション</figcaption>
                </figure>

                <h4>ナビゲーションタブ</h4>
                <ul>
                    <li><strong>Home</strong> - プロジェクト一覧画面</li>
                    <li><strong>New</strong> - 新規プロジェクト作成画面</li>
                    <li><strong>Editor</strong> - デザインエディタ画面</li>
                    <li><strong>Recipe</strong> - レシピ（材料表・工程）画面</li>
                </ul>

                <h4>アクションボタン</h4>
                <ul>
                    <li><strong>Save</strong> - 現在のプロジェクトを保存</li>
                    <li><strong>Load</strong> - 保存済みプロジェクトを読み込み</li>
                    <li><strong>Import JSON</strong> - JSONファイルからインポート</li>
                    <li><strong>Export JSON</strong> - JSONファイルとしてエクスポート（バックアップ用）</li>
                    <li><strong>SVG</strong> - SVG形式でエクスポート（ベクター画像）</li>
                    <li><strong>PNG</strong> - PNG形式でエクスポート（2倍解像度のラスター画像）</li>
                </ul>

                <h3 id="home">2.2 ホーム画面</h3>
                <p>
                    ホーム画面には、ローカルに保存されているプロジェクトの一覧が表示されます。
                    新規プロジェクトを作成するには、「New Project」ボタンをクリックします。
                </p>

                <figure>
                    <img src="images/01_home.png" alt="ホーム画面">
                    <figcaption>ホーム画面：プロジェクト一覧（空の状態）</figcaption>
                </figure>

                <h3 id="new-project">2.3 新規プロジェクト画面</h3>
                <p>
                    新規プロジェクト画面では、テンプレートを選択し、初期設定を行います。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_new_project.png" alt="新規プロジェクト画面">
                        <div class="annotation-box" style="left: 3%; top: 28%; width: 48%; height: 65%;" data-label="テンプレート選択"></div>
                        <div class="annotation-box color-teal" style="left: 53%; top: 28%; width: 44%; height: 65%;" data-label="初期設定"></div>
                    </div>
                    <figcaption>新規プロジェクト画面：テンプレート選択と初期設定</figcaption>
                </figure>

                <h4>テンプレート</h4>
                <ul>
                    <li><strong>丸つまみ菊</strong> - 丸みを帯びた花びらの菊の花</li>
                    <li><strong>剣つまみ菊</strong> - 尖った花びらの菊の花</li>
                </ul>

                <h4>初期設定項目</h4>
                <ul>
                    <li><strong>タイトル</strong> - プロジェクトの名前</li>
                    <li><strong>生地サイズ</strong> - 花びらを作る生地の基本サイズ（cm単位）</li>
                    <li><strong>土台直径</strong> - 花の土台となる円の直径（mm単位）</li>
                </ul>
            </section>

            <section id="editor">
                <h2>3. エディタ画面</h2>

                <h3 id="layout">3.1 3パネルレイアウト</h3>
                <p>
                    エディタ画面は、左・中央・右の3つのパネルで構成されています。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/03_editor_overview.png" alt="エディタ画面全体">
                        <div class="annotation-box" style="left: 0%; top: 10%; width: 25%; height: 85%;" data-label="レイヤーパネル"></div>
                        <div class="annotation-box" style="left: 26%; top: 10%; width: 47%; height: 85%;" data-label="キャンバス"></div>
                        <div class="annotation-box" style="left: 74%; top: 10%; width: 25%; height: 85%;" data-label="プロパティパネル"></div>
                    </div>
                    <figcaption>エディタ画面：左にレイヤーツリー、中央にキャンバス、右にプロパティパネル</figcaption>
                </figure>

                <ul>
                    <li><strong>左パネル（レイヤーパネル）</strong> - プロジェクト、花、レイヤーのツリー構造を表示</li>
                    <li><strong>中央パネル（キャンバス）</strong> - 花のデザインを表示・編集</li>
                    <li><strong>右パネル（プロパティパネル）</strong> - 選択中の要素のプロパティを表示・編集</li>
                </ul>

                <h3 id="canvas">3.2 キャンバス操作</h3>

                <h4>キャンバスツールバー</h4>
                <figure>
                    <div class="annotated-img">
                        <img src="images/14_canvas_toolbar.png" alt="キャンバスツールバー">
                        <div class="annotation-box label-bottom" style="left: 68%; top: 5%; width: 9%; height: 85%;" data-label="戻す/やり直し"></div>
                        <div class="annotation-box color-teal label-bottom" style="left: 78%; top: 5%; width: 9%; height: 85%;" data-label="ズーム"></div>
                        <div class="annotation-box color-navy label-bottom" style="left: 88%; top: 5%; width: 5%; height: 85%;" data-label="グリッド"></div>
                        <div class="annotation-box color-amber label-bottom" style="left: 94%; top: 5%; width: 5.5%; height: 85%;" data-label="台紙・ヘルプ"></div>
                    </div>
                    <figcaption>キャンバスツールバー：各種操作ボタン</figcaption>
                </figure>

                <ul>
                    <li><strong>元に戻す / やり直し</strong> - 操作の取り消しとやり直し</li>
                    <li><strong>ズームイン / ズームアウト</strong> - 表示倍率の変更（11段階：0.4x〜2.5x）</li>
                    <li><strong>グリッド</strong> - グリッド表示のオン/オフ</li>
                    <li><strong>表示リセット</strong> - ズームと位置を初期状態に戻す</li>
                    <li><strong>台紙</strong> - サイズ参考用のシルエット表示</li>
                    <li><strong>ヘルプ</strong> - ショートカットキーとヘルプの表示</li>
                </ul>

                <h4>その他のキャンバス機能</h4>
                <ul>
                    <li><strong>ルーラー</strong> - mm単位の目盛りを表示</li>
                    <li><strong>パン（スクロール）</strong> - キャンバスをドラッグして表示位置を移動</li>
                </ul>

                <div class="tip-box">
                    マウスホイールでズームイン/アウトができます。Shiftキーを押しながらドラッグすると、パン操作ができます。
                </div>

                <h3 id="flower-ops">3.3 花の操作</h3>

                <h4>花の選択</h4>
                <p>キャンバス上の花をクリックすると選択できます。選択された花は強調表示されます。</p>

                <h4>選択解除</h4>
                <p>キャンバスの背景（花や台紙がない空き領域）をクリックすると、現在の選択が解除されます。</p>

                <h4>花の移動</h4>
                <p>花をドラッグすると、キャンバス上で移動できます。</p>

                <h4>花の追加</h4>
                <p>レイヤーパネルの「+」ボタンをクリックすると、花の追加ダイアログが表示されます。</p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_add_flower_dialog.png" alt="花の追加ダイアログ">
                        <div class="annotation-box" style="left: 5%; top: 8%; width: 90%; height: 12%;" data-label="配置モード"></div>
                        <div class="annotation-box color-teal" style="left: 5%; top: 21%; width: 90%; height: 32%;" data-label="サイズ設定"></div>
                        <div class="annotation-box color-navy" style="left: 5%; top: 60%; width: 90%; height: 18%;" data-label="色の選択"></div>
                        <div class="annotation-box color-amber" style="left: 5%; top: 79%; width: 90%; height: 13%;" data-label="花びらの形"></div>
                    </div>
                    <figcaption>花の追加ダイアログ：配置モード、サイズ、色、形状の設定</figcaption>
                </figure>

                <h4>配置モード</h4>
                <ul>
                    <li><strong>半くす</strong> - 球面状に配置された立体的な花（つまみ細工の伝統的な形）</li>
                    <li><strong>平面</strong> - 平面状に配置された花</li>
                </ul>

                <div class="important-box">
                    半くすモードでは、花びらが球面に沿って配置されるため、外側のレイヤーほど大きな生地が必要になります。自動計算された生地サイズが表示されます。
                </div>

                <h4>花のコピー＆ペースト</h4>
                <p>
                    花を選択して <kbd>Cmd/Ctrl</kbd>+<kbd>C</kbd> でコピー、<kbd>Cmd/Ctrl</kbd>+<kbd>V</kbd> でペーストできます。
                    レイヤーパネルのコピー・ペーストボタンも使用できます。
                </p>

                <h4>花の削除</h4>
                <p>
                    花を選択して <kbd>Delete</kbd> または <kbd>Backspace</kbd> キーを押すと削除できます。
                    レイヤーパネルの「−」ボタンでも削除できます。
                </p>

                <h3 id="zone-ops">3.4 ゾーン操作（花びらのドラッグ操作）</h3>

                <div class="important-box">
                    つまみんの最も重要な機能の一つです。花びらをドラッグする位置によって、異なる操作が実行されます。
                </div>

                <p>
                    花びらの上にマウスカーソルを置くと、カーソルの形が変わり、どの操作が実行されるかが示されます。
                    ハンドルなどの目に見える操作要素はありませんが、カーソルの位置によって自動的に操作モードが切り替わります。
                </p>

                <div class="zone-diagram">
                    <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                        <!-- Petal shape -->
                        <path d="M 200 200 Q 250 150 280 100 Q 290 80 295 60 Q 300 40 295 20 Q 290 10 280 10 Q 270 10 260 20 Q 250 30 240 50 Q 230 70 220 90 Q 210 110 200 130 L 200 200 Z"
                              fill="#FFB6C1" stroke="#FF69B4" stroke-width="2" opacity="0.6"/>

                        <!-- Zone labels -->
                        <!-- Tip zone -->
                        <circle cx="290" cy="30" r="40" fill="#FF6B6B" opacity="0.3"/>
                        <text x="290" y="35" text-anchor="middle" font-size="12" fill="#000">先端</text>
                        <text x="290" y="50" text-anchor="middle" font-size="10" fill="#333">回転</text>

                        <!-- Root zone -->
                        <circle cx="200" cy="180" r="35" fill="#4ECDC4" opacity="0.3"/>
                        <text x="200" y="180" text-anchor="middle" font-size="12" fill="#000">根元</text>
                        <text x="200" y="195" text-anchor="middle" font-size="10" fill="#333">サイズ</text>

                        <!-- Middle zone -->
                        <circle cx="240" cy="100" r="30" fill="#FFE66D" opacity="0.3"/>
                        <text x="240" y="100" text-anchor="middle" font-size="12" fill="#000">中央</text>
                        <text x="240" y="115" text-anchor="middle" font-size="10" fill="#333">半径</text>

                        <!-- Side zone (left) -->
                        <ellipse cx="210" cy="120" rx="15" ry="40" fill="#A8E6CF" opacity="0.3"/>
                        <text x="180" y="125" text-anchor="middle" font-size="12" fill="#000">側面</text>
                        <text x="180" y="140" text-anchor="middle" font-size="10" fill="#333">横幅</text>

                        <!-- Center (flower center) -->
                        <circle cx="200" cy="200" r="25" fill="#DDA0DD" opacity="0.4"/>
                        <text x="200" y="205" text-anchor="middle" font-size="12" fill="#000">花の中心</text>
                        <text x="200" y="220" text-anchor="middle" font-size="10" fill="#333">移動</text>

                        <!-- Legend -->
                        <text x="10" y="350" font-size="14" font-weight="bold" fill="#333">ゾーン操作ガイド</text>
                        <text x="10" y="370" font-size="11" fill="#666">カーソルの位置によって操作が変わります</text>
                        <text x="10" y="385" font-size="11" fill="#666">カーソルの形で現在の操作を確認できます</text>
                    </svg>
                </div>

                <h4>操作ゾーン</h4>
                <ul>
                    <li><strong>先端（花びらの先、normX &gt; 0.75）</strong> - ドラッグで回転</li>
                    <li><strong>根元（花びらの根元、normX &lt; 0.3）</strong> - ドラッグでサイズ変更</li>
                    <li><strong>中央（花びらの中間部分）</strong> - ドラッグで半径調整</li>
                    <li><strong>側面（花びらの左右、|normY| &gt; 0.45）</strong> - ドラッグで横幅調整</li>
                    <li><strong>花の中心</strong> - ドラッグで花全体を移動</li>
                </ul>

                <div class="tip-box">
                    normXとnormYは、花びらの中心からの相対位置を表す正規化された座標です。カーソルの位置がこの値によって自動判定され、適切な操作モードに切り替わります。
                </div>

                <h3 id="layer-panel">3.5 レイヤーパネル</h3>
                <p>
                    レイヤーパネルには、プロジェクト全体の階層構造がツリー形式で表示されます。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_layer_tree_expanded.png" alt="レイヤーパネルツールバー">
                        <div class="annotation-box" style="left: 4%; top: 9%; width: 92%; height: 11%;" data-label="ツールバー"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 22%; width: 92%; height: 9%;" data-label="プロジェクト名"></div>
                        <div class="annotation-box color-navy" style="left: 4%; top: 33%; width: 92%; height: 35%;" data-label="ツリー構造（花・レイヤー）"></div>
                    </div>
                    <figcaption>レイヤーパネル：プロジェクト、花、レイヤーのツリー構造</figcaption>
                </figure>

                <h4>ツリー構造</h4>
                <ul>
                    <li><strong>プロジェクト</strong> - 最上位のノード</li>
                    <li><strong>花</strong> - プロジェクトに含まれる花（複数可）</li>
                    <li><strong>レイヤー</strong> - 花を構成するレイヤー（通常、外側・中間・内側など）</li>
                </ul>

                <h4>レイヤーパネルのボタン</h4>
                <ul>
                    <li><strong>+ ボタン</strong> - 新しい花を追加</li>
                    <li><strong>− ボタン</strong> - 選択中の要素を削除</li>
                    <li><strong>コピーボタン</strong> - 選択中の花をコピー</li>
                    <li><strong>ペーストボタン</strong> - コピーした花をペースト</li>
                    <li><strong>最前面ボタン</strong> - 選択中の花を最前面に移動</li>
                    <li><strong>最背面ボタン</strong> - 選択中の花を最背面に移動</li>
                    <li><strong>1つ前ボタン</strong> - 選択中の花を1つ前に移動</li>
                    <li><strong>1つ後ろボタン</strong> - 選択中の花を1つ後ろに移動</li>
                </ul>

                <h4>レイヤーの表示/非表示とロック</h4>
                <p>
                    各レイヤーには、「表示」と「ロック」のチェックボックスがあります。
                    表示をオフにすると、そのレイヤーはキャンバスに表示されなくなります。
                    ロックをオンにすると、そのレイヤーは編集できなくなります。
                </p>

                <h3 id="property-panel">3.6 プロパティパネル</h3>
                <p>
                    プロパティパネルには、選択中の要素に応じた編集可能なプロパティが表示されます。
                </p>

                <h4>プロジェクト選択時</h4>
                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_prop_project.png" alt="プロジェクトプロパティ">
                        <div class="annotation-box" style="left: 4%; top: 3%; width: 92%; height: 16%;" data-label="タイトル"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 20%; width: 92%; height: 24%;" data-label="サイズ設定"></div>
                        <div class="annotation-box color-navy" style="left: 4%; top: 46%; width: 92%; height: 16%;" data-label="メモ"></div>
                        <div class="annotation-box color-amber" style="left: 4%; top: 63%; width: 92%; height: 25%;" data-label="カラーパレット"></div>
                    </div>
                    <figcaption>プロジェクト選択時のプロパティパネル</figcaption>
                </figure>
                <ul>
                    <li><strong>タイトル</strong> - プロジェクト名</li>
                    <li><strong>生地サイズ</strong> - デフォルトの生地サイズ（cm）</li>
                    <li><strong>土台直径</strong> - デフォルトの土台直径（mm）</li>
                    <li><strong>メモ</strong> - プロジェクトに関する自由なメモ</li>
                    <li><strong>パレット</strong> - プロジェクト全体のカラーパレット</li>
                </ul>

                <h4>花選択時</h4>
                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_prop_flower.png" alt="花のプロパティ">
                        <div class="annotation-box" style="left: 4%; top: 5%; width: 92%; height: 18%;" data-label="名前・花びらの形"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 24%; width: 92%; height: 24%;" data-label="花びら数・直径・横幅・角度"></div>
                        <div class="annotation-box color-navy" style="left: 4%; top: 49%; width: 92%; height: 10%;" data-label="色"></div>
                    </div>
                    <figcaption>花選択時のプロパティパネル：花全体の設定</figcaption>
                </figure>
                <ul>
                    <li><strong>名前</strong> - 花の名前</li>
                    <li><strong>花びらの形</strong> - 丸つまみ / 剣つまみの切り替え</li>
                    <li><strong>花びら数</strong> - 1つのレイヤーあたりの花びらの数</li>
                    <li><strong>直径</strong> - 花の直径（mm）</li>
                    <li><strong>横幅</strong> - 花びらの横幅倍率</li>
                    <li><strong>角度</strong> - 花全体の回転角度</li>
                    <li><strong>色</strong> - 花全体の基本色</li>
                    <li><strong>花芯</strong> - 花の中心部分の設定（パール/座金/ペップ）</li>
                    <li><strong>花びらサイズ調整</strong> - 半くす配置時の生地サイズ調整モード</li>
                </ul>

                <h4>レイヤー選択時</h4>
                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_prop_layer.png" alt="レイヤーのプロパティ">
                        <div class="annotation-box" style="left: 4%; top: 5%; width: 92%; height: 20%;" data-label="名前・花びらの形"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 26%; width: 92%; height: 40%;" data-label="花びら数・直径・生地サイズ・横幅・角度"></div>
                        <div class="annotation-box color-navy" style="left: 4%; top: 67%; width: 92%; height: 12%;" data-label="色"></div>
                        <div class="annotation-box color-amber" style="left: 4%; top: 80%; width: 92%; height: 12%;" data-label="表示・ロック"></div>
                    </div>
                    <figcaption>レイヤー選択時のプロパティパネル：レイヤー固有の設定</figcaption>
                </figure>
                <ul>
                    <li><strong>名前</strong> - レイヤーの名前</li>
                    <li><strong>花びらの形</strong> - このレイヤーの花びらの形</li>
                    <li><strong>花びら数</strong> - このレイヤーの花びらの数</li>
                    <li><strong>直径</strong> - このレイヤーの直径（mm）</li>
                    <li><strong>生地サイズ</strong> - このレイヤーの花びらを作る生地のサイズ（cm）</li>
                    <li><strong>サイズ倍率</strong> - 花びらのサイズ倍率</li>
                    <li><strong>横幅</strong> - このレイヤーの花びらの横幅倍率</li>
                    <li><strong>角度</strong> - このレイヤーの回転角度</li>
                    <li><strong>色</strong> - このレイヤーの色</li>
                    <li><strong>表示</strong> - レイヤーの表示/非表示</li>
                    <li><strong>ロック</strong> - レイヤーの編集ロック</li>
                </ul>

                <h4>花びら選択時</h4>
                <p>
                    花びらを個別に選択すると（レイヤー内でクリック）、その花びら固有のプロパティが表示されます。
                    位置情報（読み取り専用）のほか、色や形を個別に変更できます。
                </p>
                <ul>
                    <li><strong>位置</strong> - 花びらの位置（読み取り専用）</li>
                    <li><strong>色の個別変更</strong> - この花びらだけ異なる色にする</li>
                    <li><strong>形の個別変更</strong> - この花びらだけ異なる形にする</li>
                </ul>

                <h3 id="petal-shapes">3.7 花びらの形</h3>
                <p>
                    つまみんでは、2種類の花びらの形を選択できます。
                </p>

                <h4>丸つまみ</h4>
                <p>
                    丸みを帯びた、柔らかい印象の花びらです。伝統的なつまみ細工の代表的な形状の一つです。
                </p>

                <h4>剣つまみ</h4>
                <figure>
                    <img src="images/crop_ken_canvas.png" alt="剣つまみの花">
                    <figcaption>剣つまみの花：尖った花びらが特徴</figcaption>
                </figure>
                <p>
                    先端が尖った、シャープな印象の花びらです。菊の花などによく使われます。
                </p>

                <div class="tip-box">
                    花全体の形を変更することも、レイヤーごとに異なる形を使うことも、個々の花びらだけ形を変えることもできます。
                </div>

                <h3 id="center">3.8 花芯（Center）</h3>
                <p>
                    花の中心部分には、3種類の花芯を設定できます。
                </p>

                <p>
                    花のプロパティパネルの「花芯」セクションで、「+ 花芯を追加」ボタンをクリックすると花芯を設定できます。
                </p>

                <h4>花芯の種類</h4>
                <ul>
                    <li><strong>パール</strong> - 丸い、真珠のような中心</li>
                    <li><strong>座金</strong> - 王冠のような形の中心</li>
                    <li><strong>ペップ</strong> - 放射状に広がる、おしべのような中心</li>
                </ul>

                <h4>設定項目</h4>
                <ul>
                    <li><strong>サイズ</strong> - 花芯のサイズ</li>
                    <li><strong>色</strong> - 花芯の色</li>
                </ul>

                <h3 id="color-palette">3.9 カラーパレット</h3>
                <p>
                    カラーパレットには、20色のデフォルトカラーと、最近使った色（最大10色）が表示されます。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/05_layer_selected.png" alt="カラーパレット">
                        <div class="annotation-box" style="left: 75%; top: 44%; width: 24%; height: 10%;" data-label="カラーパレット"></div>
                    </div>
                    <figcaption>カラーパレット：20色のデフォルトカラーと最近使った色</figcaption>
                </figure>

                <p>
                    パレットの右上にある展開/折りたたみボタンをクリックすると、パレットの表示/非表示を切り替えられます。
                </p>

                <div class="tip-box">
                    色の四角をクリックすると、その色が選択中の要素に適用されます。最近使った色は自動的に記録されます。
                </div>

                <h3 id="stencil">3.10 台紙（ステンシル）</h3>
                <p>
                    台紙は、作成した花のサイズを確認するための人物シルエットです。
                    キャンバスツールバーの「台紙」メニューから選択できます。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_stencil_menu.png" alt="台紙メニュー">
                        <div class="annotation-box" style="left: 4%; top: 2%; width: 92%; height: 50%;" data-label="成人女性"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 54%; width: 92%; height: 42%;" data-label="子供"></div>
                    </div>
                    <figcaption>台紙メニュー：成人女性と子供のシルエット</figcaption>
                </figure>

                <h4>台紙の種類</h4>
                <ul>
                    <li><strong>成人女性</strong> - 右向き / 左向き / 後ろ向き</li>
                    <li><strong>子供</strong> - 右向き / 左向き / 後ろ向き</li>
                </ul>

                <div class="img-pair">
                    <figure class="full-view">
                        <div class="annotated-img">
                            <img src="images/16_with_stencil.png" alt="台紙と花">
                            <div class="annotation-box" style="left: 38%; top: 25%; width: 24%; height: 60%;" data-label="台紙シルエット"></div>
                        </div>
                        <figcaption>台紙を使ったサイズ確認：成人女性のシルエットと花</figcaption>
                    </figure>
                </div>

                <p>
                    台紙はドラッグで移動できます。台紙をクリックすると選択状態になり、削除などの操作ができます。
                    キャンバスの空き領域をクリックすると選択が解除されます。
                </p>

                <h3 id="petal-sizing">3.11 花びらサイズ調整（半くす）</h3>
                <p>
                    半くす配置モードでは、花びらが球面に沿って配置されるため、外側のレイヤーほど大きな生地が必要になります。
                    つまみんは、球面投影に基づいて各レイヤーの生地サイズを自動計算します。
                </p>

                <h4>サイズ調整モード</h4>
                <ul>
                    <li><strong>均一モード</strong> - すべてのレイヤーで同じ生地サイズを使用（指定されたサイズ）</li>
                    <li><strong>段階モード</strong> - 外側から内側へ段階的に小さくなる生地サイズを自動計算</li>
                </ul>

                <div class="important-box">
                    段階モードでは、球面の曲率に基づいて各レイヤーの生地サイズが自動計算されます。これにより、リアルなつまみ細工に近い材料表が作成されます。
                </div>
            </section>

            <section id="recipe">
                <h2>4. レシピ画面</h2>
                <p>
                    レシピ画面では、作成したデザインの材料表と工程が自動的に生成されます。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_recipe.png" alt="レシピ画面">
                        <div class="annotation-box" style="left: 2%; top: 20%; width: 49%; height: 75%;" data-label="材料表（色別）"></div>
                        <div class="annotation-box color-teal" style="left: 53%; top: 20%; width: 45%; height: 75%;" data-label="工程（花・レイヤー単位）"></div>
                    </div>
                    <figcaption>レシピ画面：材料表（色別）と工程（花・レイヤー単位）</figcaption>
                </figure>

                <h3>材料表</h3>
                <p>
                    材料表には、使用する生地の色とサイズごとの必要枚数が表示されます。
                    同じ色の生地でも、サイズが異なる場合は別の行に表示されます。
                </p>

                <h3>工程</h3>
                <p>
                    工程には、花ごと、レイヤーごとに、以下の情報が表示されます：
                </p>
                <ul>
                    <li>レイヤー名</li>
                    <li>花びらの形（丸つまみ / 剣つまみ）</li>
                    <li>花びらの数</li>
                    <li>直径（mm）</li>
                    <li>生地サイズ（cm）</li>
                    <li>色</li>
                </ul>

                <div class="tip-box">
                    レシピ画面はブラウザの印刷機能で印刷できます。材料を購入する際や、実際につまみ細工を作る際に便利です。
                </div>
            </section>

            <section id="data">
                <h2>5. データ管理</h2>

                <h3 id="save-load">5.1 プロジェクトの保存と読み込み</h3>
                <p>
                    つまみんでは、プロジェクトはブラウザのローカルストレージに保存されます。
                </p>

                <h4>保存（Save）</h4>
                <p>
                    ヘッダーの「Save」ボタンをクリックすると、現在のプロジェクトがローカルストレージに保存されます。
                    保存されたプロジェクトは、ホーム画面のプロジェクト一覧に表示されます。
                </p>

                <h4>読み込み（Load）</h4>
                <p>
                    ヘッダーの「Load」ボタンをクリックすると、保存済みのプロジェクト一覧が表示されます。
                    読み込みたいプロジェクトを選択すると、エディタに読み込まれます。
                </p>

                <div class="important-box">
                    ブラウザのデータを削除すると、ローカルストレージのデータも削除されます。
                    大切なプロジェクトは、必ずJSON形式でエクスポートしてバックアップを取ってください。
                </div>

                <h3 id="import-export">5.2 インポート / エクスポート</h3>

                <h4>JSONエクスポート</h4>
                <p>
                    「Export JSON」ボタンをクリックすると、現在のプロジェクトをJSON形式のファイルとしてダウンロードできます。
                    このファイルは、バックアップや他のコンピュータへの移行に使用できます。
                </p>

                <h4>JSONインポート</h4>
                <p>
                    「Import JSON」ボタンをクリックすると、以前エクスポートしたJSONファイルを読み込むことができます。
                    ファイル選択ダイアログが表示されるので、読み込みたいJSONファイルを選択してください。
                </p>

                <h4>SVGエクスポート</h4>
                <p>
                    「SVG」ボタンをクリックすると、現在のデザインをSVG（Scalable Vector Graphics）形式でダウンロードできます。
                    SVGはベクター画像なので、拡大しても画質が劣化しません。
                    Illustratorなどのベクター編集ソフトで開くことができます。
                </p>

                <h4>PNGエクスポート</h4>
                <p>
                    「PNG」ボタンをクリックすると、現在のデザインをPNG（Portable Network Graphics）形式でダウンロードできます。
                    PNGは2倍の解像度でエクスポートされるため、高品質な画像として使用できます。
                </p>

                <div class="tip-box">
                    SVGは編集可能なベクター形式、PNGは印刷や共有に適したラスター形式です。用途に応じて使い分けてください。
                </div>
            </section>

            <section id="shortcuts">
                <h2>6. キーボードショートカット</h2>
                <p>
                    つまみんでは、以下のキーボードショートカットが使用できます。
                </p>

                <figure>
                    <div class="annotated-img">
                        <img src="images/crop_help_dialog.png" alt="ショートカット一覧">
                        <div class="annotation-box" style="left: 4%; top: 8%; width: 92%; height: 57%;" data-label="キーボードショートカット"></div>
                        <div class="annotation-box color-teal" style="left: 4%; top: 67%; width: 92%; height: 30%;" data-label="マウス操作"></div>
                    </div>
                    <figcaption>ショートカット＆ヘルプダイアログ</figcaption>
                </figure>

                <table class="shortcuts-table">
                    <thead>
                        <tr>
                            <th>操作</th>
                            <th>ショートカット</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>元に戻す</td>
                            <td><kbd>Ctrl</kbd>+<kbd>Z</kbd> (Windows) / <kbd>Cmd</kbd>+<kbd>Z</kbd> (Mac)</td>
                        </tr>
                        <tr>
                            <td>やり直し</td>
                            <td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd> (Windows) / <kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd> (Mac)</td>
                        </tr>
                        <tr>
                            <td>コピー</td>
                            <td><kbd>Ctrl</kbd>+<kbd>C</kbd> (Windows) / <kbd>Cmd</kbd>+<kbd>C</kbd> (Mac)</td>
                        </tr>
                        <tr>
                            <td>ペースト</td>
                            <td><kbd>Ctrl</kbd>+<kbd>V</kbd> (Windows) / <kbd>Cmd</kbd>+<kbd>V</kbd> (Mac)</td>
                        </tr>
                        <tr>
                            <td>保存</td>
                            <td><kbd>Ctrl</kbd>+<kbd>S</kbd> (Windows) / <kbd>Cmd</kbd>+<kbd>S</kbd> (Mac)</td>
                        </tr>
                        <tr>
                            <td>削除</td>
                            <td><kbd>Delete</kbd> / <kbd>Backspace</kbd></td>
                        </tr>
                        <tr>
                            <td>複数選択</td>
                            <td><kbd>Shift</kbd> + クリック</td>
                        </tr>
                        <tr>
                            <td>移動</td>
                            <td>ドラッグ</td>
                        </tr>
                        <tr>
                            <td>レイヤー選択</td>
                            <td>ダブルクリック</td>
                        </tr>
                    </tbody>
                </table>

                <div class="tip-box">
                    キャンバス上で「ヘルプ」ボタン（？アイコン）をクリックすると、いつでもショートカット一覧を確認できます。
                </div>
            </section>

            <section id="mobile">
                <h2>7. モバイル対応</h2>
                <p>
                    つまみんは、スマートフォンやタブレットでも使用できます。
                    タッチ操作に最適化された機能が用意されています。
                </p>

                <h3>タッチ操作</h3>
                <ul>
                    <li><strong>タップ</strong> - 要素の選択</li>
                    <li><strong>ドラッグ</strong> - 移動・編集</li>
                    <li><strong>2本指でドラッグ</strong> - キャンバスのパン（スクロール）</li>
                    <li><strong>ピンチイン/アウト</strong> - ズームイン/アウト</li>
                    <li><strong>長押し（500ms）</strong> - 複数選択モードに入る（バイブレーション付き）</li>
                </ul>

                <h3>タッチゾーンインジケーター</h3>
                <p>
                    タッチデバイスでは、花びらをタッチした際に、現在のゾーン（先端・根元・中央・側面）がビジュアルに表示されます。
                    これにより、どの操作が実行されるかを事前に確認できます。
                </p>

                <div class="tip-box">
                    モバイルデバイスでは、画面を横向きにすると、より広い作業スペースが確保できます。
                </div>
            </section>

            <div style="margin-top: 4rem; padding-top: 2rem; border-top: 2px solid var(--border-color); text-align: center; color: var(--text-light);">
                <p>つまみん - つまみ細工デザインツール</p>
                <p style="font-size: 0.9rem;">このマニュアルは、つまみんの使い方を包括的に説明したものです。</p>
                <p style="font-size: 0.9rem;">ご不明な点がございましたら、お気軽にお問い合わせください。</p>
            </div>
        </main>
    </div>

    <a href="#" class="back-to-top" id="backToTop">↑</a>

    <script>
        // Back to top button
        const backToTop = document.getElementById('backToTop');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        backToTop.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Highlight current section in TOC
        const sections = document.querySelectorAll('section[id]');
        const tocLinks = document.querySelectorAll('.toc a[href^="#"]');

        function highlightTOC() {
            let current = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            tocLinks.forEach(link => {
                link.style.fontWeight = 'normal';
                link.style.color = 'var(--text-light)';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.fontWeight = 'bold';
                    link.style.color = 'var(--dark-pink)';
                }
            });
        }

        window.addEventListener('scroll', highlightTOC);
        highlightTOC(); // Initial call
    </script>
</body>
</html>
